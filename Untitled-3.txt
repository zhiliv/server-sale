
Процедура КнопкаВыполнитьНажатие(Кнопка)
		//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	

КонецПроцедуры

Процедура ВыгрузкаДисконтныхКартИз1СНажатие(Элемент)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДисконтныеКартыОстатки.СуммаБонусаОстаток КАК СуммаБонусаОстаток,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.ФИОВладельца КАК ФИОВладельца,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.ДеньРожденияКлиента КАК ДеньРожденияКлиента,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.ТелефонОтправкиСМС КАК ТелефонОтправкиСМС,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.НомерКарты КАК НомерКарты,
		|	ДисконтныеКартыОстатки.ДисконтнаяКарта.КартаЗапрещена КАК КартаЗапрещена
		|ИЗ
		|	РегистрНакопления.ДисконтныеКарты.Остатки КАК ДисконтныеКартыОстатки";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	дата = ТекущаяДата();
	месяц = Месяц(дата);
	день = День(дата);
	Соединение = Новый HTTPСоединение("46.72.31.213",81);
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Структура = Новый Структура;
		Структура.Вставить("SummaBonusa", ВыборкаДетальныеЗаписи.СуммаБонусаОстаток);
		Структура.Вставить("FIO", ВыборкаДетальныеЗаписи.ФИОВладельца);
		Структура.Вставить("email", ВыборкаДетальныеЗаписи.АдресЭлектроннойПочты);
		Структура.Вставить("dr", ВыборкаДетальныеЗаписи.ДеньРожденияКлиента);
		Структура.Вставить("phone", ВыборкаДетальныеЗаписи.ТелефонОтправкиСМС);
		Структура.Вставить("numCard", ВыборкаДетальныеЗаписи.НомерКарты);
		Структура.Вставить("enabledCard", ВыборкаДетальныеЗаписи.КартаЗапрещена);

	//HTTPЗапрос = Новый HTTPЗапрос("/getClient1C/"+Строка(месяц)+Строка(день));
// Создаем временный файл, который будет
// передан в теле POST-запроса
ФайлЗапроса = ПолучитьИмяВременногоФайла();    
// Записываем в файл текстовое содержимое
// тела запроса (переменная "ТелоЗапроса")
ТекстовыйФайл = Новый ТекстовыйДокумент;
ТекстовыйФайл.УстановитьТекст(Структура);           
ТекстовыйФайл.Записать(ФайлЗапроса, КодировкаТекста.ANSI);
// Получаем размер отправляемых данных в теле запроса
ФайлОтправки = Новый Файл(ФайлЗапроса);
РазмерФайлаОтправки = XMLСтрока(ФайлОтправки.Размер());
// Подготовим временный файл для получения тела
// ответа POST-запроса
ФайлРезультата = ПолучитьИмяВременногоФайла();

// Для того, чтобы установить заголовки 
// POST-запроса создадим соответствие
ЗаголовокHTTP = Новый Соответствие();
// В этом примере устанавливаем в заголовках запроса
// размер передаваемых данных и их тип
ЗаголовокHTTP.Вставить("Content-Length", РазмерФайлаОтправки);
ЗаголовокHTTP.Вставить("Content-Type", "application/json; charset=utf-8");

// Отправляем POST-запрос для обработки. 
// Параметры:
//  1. Файл запроса - путь к файлу, содержащего
//        тело запроса
//  2. Ресурс - ссылка на страницу веб-сервера,
//        к которой выполняется POST-запрос
//  3. ФайлРезультат - файл, в который будет
//        помещено тело ответа сервера
//  4. ЗаголовокHTTP - соответствие с заголовками
//        POST-запроса
Соединение.ОтправитьДляОбработки(ФайлЗапроса, "/getClient1C/"+Строка(месяц)+Строка(день), 
                           ФайлРезультата, ЗаголовокHTTP);

// Получаем ответ веб-сервера на POST-запрос
// в виде текста
ТекстовыйФайлОтвет = Новый ТекстовыйДокумент;
ТекстовыйФайлОтвет.Прочитать(ФайлРезультата,КодировкаТекста.UTF8);
СтрокаОтветСервера = ТекстовыйФайлОтвет.ПолучитьТекст();
	

	КонецЦикла;
	
	
	
	

	
КонецПроцедуры

Процедура ЗагрузкаССервераНажатие(Элемент)
	 ЧтениеJSON = Новый ЧтениеJSON;
	 ЧтениеJSON.ОткрытьФайл("D:\тест\load.json");
	ДАнные = ПрочитатьJSON(ЧтениеJSON);	
	
	
	Для Каждого Строка из ДАнные Цикл
		Сообщить(Строка.FIO);
	КонецЦикла;
КонецПроцедуры
